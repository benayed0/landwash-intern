<div class="modal-overlay" *ngIf="isOpen" (click)="onCancel()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üõçÔ∏è {{ modalTitle }}</h3>
      <button class="close-btn" (click)="onCancel()">√ó</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="onSubmit()" #productForm="ngForm">
        <!-- Product Name -->
        <div class="form-group">
          <label for="name">Nom du produit *</label>
          <input
            type="text"
            id="name"
            [(ngModel)]="formData.name"
            name="name"
            class="form-input"
            [class.error]="errors['name']"
            placeholder="Ex: Shampoing Premium"
            required
            [disabled]="isSubmitting"
          />
          <span class="error-message" *ngIf="errors['name']">{{
            errors["name"]
          }}</span>
        </div>

        <!-- Product Type -->
        <div class="form-group">
          <label for="type">Type de produit *</label>
          <input
            type="text"
            id="type"
            [(ngModel)]="formData.type"
            name="type"
            class="form-input"
            [class.error]="errors['type']"
            placeholder="Ex: Shampoing, Cire, Nettoyant"
            required
            [disabled]="isSubmitting"
          />
          <span class="error-message" *ngIf="errors['type']">{{
            errors["type"]
          }}</span>
        </div>

        <!-- Price -->
        <div class="form-group">
          <label for="price">Prix (TND) *</label>
          <input
            type="number"
            id="price"
            [(ngModel)]="formData.price"
            name="price"
            class="form-input"
            [class.error]="errors['price']"
            placeholder="0.00"
            min="0"
            step="0.01"
            required
            [disabled]="isSubmitting"
          />
          <span class="error-message" *ngIf="errors['price']">{{
            errors["price"]
          }}</span>
        </div>

        <!-- Details -->
        <div class="form-group">
          <label for="details">Description *</label>
          <textarea
            id="details"
            [(ngModel)]="formData.details"
            name="details"
            class="form-input textarea"
            [class.error]="errors['details']"
            placeholder="Description d√©taill√©e du produit..."
            rows="4"
            required
            [disabled]="isSubmitting"
          ></textarea>
          <span class="error-message" *ngIf="errors['details']">{{
            errors["details"]
          }}</span>
        </div>

        <!-- Instructions of Use -->
        <div class="form-group">
          <label for="instructions">Instructions d'utilisation</label>
          <textarea
            id="instructions"
            [(ngModel)]="formData.instructions_of_use"
            name="instructions"
            class="form-input textarea"
            placeholder="Comment utiliser ce produit..."
            rows="3"
            [disabled]="isSubmitting"
          ></textarea>
        </div>

        <!-- Pictures Upload -->
        <div class="form-group">
          <label>Images du produit</label>
          <div class="pictures-section">
            <div class="file-upload-area">
              <input
                type="file"
                id="pictures"
                multiple
                accept="image/*"
                (change)="onFileSelect($event)"
                class="file-input"
                [disabled]="isSubmitting"
              />
              <label for="pictures" class="file-upload-label">
                <span class="upload-icon">üìÅ</span>
                <span class="upload-text">
                  Cliquez pour s√©lectionner des images<br />
                  <small
                    >Formats accept√©s: JPG, PNG, GIF (max 5MB chacune)</small
                  >
                </span>
              </label>
            </div>
            <p class="help-text">
              üí° Vous pouvez s√©lectionner plusieurs images √† la fois
            </p>
          </div>
        </div>

        <!-- Preview -->
        <div class="preview-section" *ngIf="previewUrls.length > 0">
          <label>Aper√ßu des images</label>
          <div class="image-previews">
            <div
              *ngFor="let preview of previewUrls; let i = index"
              class="preview-item"
            >
              <img
                [src]="preview"
                [alt]="formData.name"
                class="preview-image"
              />
              <button
                type="button"
                class="remove-preview-btn"
                (click)="removeFile(i)"
                [disabled]="isSubmitting"
              >
                ‚úï
              </button>
            </div>
          </div>
        </div>

        <!-- Pack Mode Toggle -->
        <div class="form-group">
          <div class="pack-toggle">
            <label class="checkbox-container">
              <input
                type="checkbox"
                [checked]="isPackMode"
                name="isPackMode"
                (change)="togglePackMode()"
                [disabled]="isSubmitting"
              />
              <span class="checkmark"></span>
              <span class="checkbox-label">üì¶ Cr√©er un pack de produits</span>
            </label>
          </div>
        </div>

        <!-- Pack Products Selection -->
        <div class="form-group" *ngIf="isPackMode">
          <label>S√©lectionner les produits du pack</label>
          <div class="pack-products-section">
            <div class="products-list" *ngIf="availableProducts.length > 0">
              <div
                class="product-option"
                *ngFor="let product of availableProducts"
              >
                <label class="checkbox-container">
                  <input
                    type="checkbox"
                    [checked]="isProductSelected(product._id)"
                    (change)="handleProductSelectionChange(product._id, $event)"
                    [disabled]="isSubmitting"
                  />
                  <span class="checkmark"></span>
                  <span class="product-option-info">
                    <span class="product-option-name">{{ product.name }}</span>
                    <span class="product-option-price">{{
                      formatPrice(product.price)
                    }}</span>
                  </span>
                </label>
              </div>
            </div>
            <div class="no-products" *ngIf="availableProducts.length === 0">
              Aucun produit disponible pour cr√©er un pack
            </div>
            <div class="pack-summary" *ngIf="selectedProductIds.length > 0">
              <strong
                >{{ selectedProductIds.length }} produit(s)
                s√©lectionn√©(s)</strong
              >
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-actions">
      <button
        type="button"
        class="btn-cancel"
        (click)="onCancel()"
        [disabled]="isSubmitting"
      >
        Annuler
      </button>
      <button
        type="button"
        class="btn-confirm"
        (click)="onSubmit()"
        [disabled]="isSubmitting"
      >
        {{ submitButtonText }}
      </button>
    </div>
  </div>
</div>
