<div class="order-card">
  <div class="order-header">
    <div class="order-info">
      <div class="order-icon">üì¶</div>
      <div>
        <div>Commande #{{ order._id?.slice(-6) }}</div>
        <div class="detail-value">{{ order.userId.name }}</div>
      </div>
    </div>
    <div class="status-badge" [ngClass]="getStatusClass(order.status)">
      {{ order.status }}
    </div>
  </div>

  <div class="order-details">
    <div class="detail-item">
      <div class="detail-label">Date de commande</div>
      <div class="detail-value">{{ formatDate(order.createdAt) }}</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">Adresse de livraison</div>
      <div class="detail-value">
        <a
          href="https://www.google.com/maps/search/?api=1&query={{
            order.coordinates[1]
          }},{{ order.coordinates[0] }}"
          target="_blank"
          >{{ order.shippingAddress }}</a
        >
      </div>
    </div>
    <div class="detail-item">
      <div class="detail-label">T√©l√©phone</div>
      <div class="detail-value">{{ order.userId.phoneNumber }}</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">M√©thode de paiement</div>
      <div class="detail-value">{{ order.paymentMethod }}</div>
    </div>
    <div class="detail-item" *ngIf="order.notes">
      <div class="detail-label">Notes</div>
      <div class="detail-value">{{ order.notes }}</div>
    </div>
  </div>

  <div class="products-list">
    <div class="detail-label" style="margin-bottom: 10px">
      Produits command√©s
    </div>
    <div class="product-item" *ngFor="let product of order.products">
      <div class="product-info">
        <img
          *ngIf="
            product.productId.pictures && product.productId.pictures.length > 0
          "
          [src]="product.productId.pictures[0]"
          [alt]="product.productId.name"
          class="product-image"
        />
        <div class="product-details">
          <div class="product-name">{{ product.productId.name }}</div>
          <div class="product-type">{{ product.productId.type }}</div>
          <div class="product-quantity">Quantit√©: {{ product.quantity }}</div>
        </div>
      </div>
      <div class="product-price">
        {{
          product.price * product.quantity
            | currency : "TND" : "symbol" : "1.0-0"
        }}
      </div>
    </div>
  </div>

  <div class="total-price">
    Total: {{ order.totalPrice | currency : "TND" : "symbol" : "1.0-0" }}
  </div>

  <div
    class="order-actions"
    *ngIf="
      userRole === 'admin' &&
      order.status !== 'completed' &&
      order.status !== 'cancelled'
    "
  >
    <button
      *ngFor="let action of getAvailableActions()"
      class="action-btn"
      [ngClass]="action.class"
      (click)="onActionClick(action.status)"
    >
      {{ action.label }}
    </button>
  </div>

  <!-- Delivery Date Modal -->
  <div class="modal-overlay" *ngIf="showDeliveryDateModal" (click)="closeDeliveryDateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Date de livraison estim√©e</h3>
        <button class="close-btn" (click)="closeDeliveryDateModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <label for="deliveryDate">S√©lectionnez la date de livraison estim√©e :</label>
          <input
            id="deliveryDate"
            type="date"
            [(ngModel)]="estimatedDeliveryDate"
            [min]="getTomorrowDate()"
            class="date-input"
            required
          />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeDeliveryDateModal()">
          Annuler
        </button>
        <button
          class="btn-confirm"
          (click)="onConfirmWithDeliveryDate()"
          [disabled]="!estimatedDeliveryDate"
        >
          Confirmer la commande
        </button>
      </div>
    </div>
  </div>
</div>
