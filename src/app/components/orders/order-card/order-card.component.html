<div class="order-card">
  <!-- Compact Header with Total Price -->
  <div class="order-header">
    <div class="order-info">
      <div class="order-icon">ğŸ“¦</div>
      <div class="order-meta">
        <div class="order-id">#{{ order._id?.slice(-6) }}</div>
        <div class="order-date">{{ formatDate(order.createdAt) }}</div>
      </div>
    </div>
    <div class="header-right">
      <div class="total-price-compact">
        {{ order.totalPrice | currency : "TND" : "symbol" : "1.0-0" }}
      </div>
      <div class="status-badge" [ngClass]="getStatusClass(order.status)">
        {{ order.status }}
      </div>
    </div>
  </div>

  <!-- Collapsible Customer Details -->
  <details class="collapsible-section">
    <summary class="section-header">
      <span class="section-icon">ğŸ‘¤</span>
      <span class="section-title">{{ order.userId.name }}</span>
      <span class="expand-icon">â–¼</span>
    </summary>
    <div class="section-content">
      <a href="tel:{{ order.userId.phoneNumber }}" class="contact-item">
        <span class="contact-icon">ğŸ“±</span>
        <span class="contact-text">{{ order.userId.phoneNumber }}</span>
      </a>
      <a
        href="https://www.google.com/maps/search/?api=1&query={{
          order.coordinates[1]
        }},{{ order.coordinates[0] }}"
        target="_blank"
        class="contact-item"
      >
        <span class="contact-icon">ğŸ“</span>
        <span class="contact-text">{{ order.shippingAddress }}</span>
      </a>
      <div class="info-item">
        <span class="info-icon">ğŸ’³</span>
        <span class="info-text">{{ order.paymentMethod }}</span>
      </div>
      <div class="info-item" *ngIf="order.notes">
        <span class="info-icon">ğŸ“</span>
        <span class="info-text">{{ order.notes }}</span>
      </div>
    </div>
  </details>

  <!-- Collapsible Products List -->
  <details class="collapsible-section products-section">
    <summary class="section-header">
      <span class="section-icon">ğŸ“¦</span>
      <span class="section-title">Produits ({{ order.products.length }})</span>
      <span class="expand-icon">â–¼</span>
    </summary>
    <div class="section-content">
      <div class="product-item" *ngFor="let product of order.products">
        <div class="product-info">
          <img
            *ngIf="
              product.productId.pictures &&
              product.productId.pictures.length > 0
            "
            [src]="product.productId.pictures[0]"
            [alt]="product.productId.name"
            class="product-image"
          />
          <div class="product-details">
            <div class="product-name">{{ product.productId.name }}</div>
            <div class="product-meta">
              <span class="product-type">{{ product.productId.type }}</span>
              <span class="product-quantity">Ã—{{ product.quantity }}</span>
            </div>
          </div>
        </div>
        <div class="product-price">
          {{
            product.price * product.quantity
              | currency : "TND" : "symbol" : "1.0-0"
          }}
        </div>
      </div>
    </div>
  </details>

  <!-- Compact Action Buttons -->
  <div
    class="order-actions compact"
    *ngIf="userRole === 'admin' && order.status !== 'completed'"
  >
    <button
      *ngFor="let action of availableActions()"
      class="action-btn"
      [ngClass]="action.class"
      (click)="onActionClick(action)"
      [title]="action.label"
    >
      <span class="btn-icon">{{ action.label.split(" ")[0] }}</span>
      <span class="btn-text">{{
        action.label.substring(action.label.indexOf(" ") + 1)
      }}</span>
    </button>
  </div>
</div>
