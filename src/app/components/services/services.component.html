<div class="services-container">
  <div class="content">
    <div class="page-header">
      <h1>‚öôÔ∏è Services & Localisations</h1>
      <div class="view-toggle">
        <button
          class="toggle-btn"
          [class.active]="viewMode === 'services'"
          (click)="switchView('services')"
        >
          üìã Services
        </button>
        <button
          class="toggle-btn"
          [class.active]="viewMode === 'locations'"
          (click)="switchView('locations')"
        >
          üìç Localisations
        </button>
      </div>
    </div>

    <!-- Services View -->
    <div *ngIf="viewMode === 'services'">
      <!-- Filter Tabs -->
      <div class="filter-tabs" *ngIf="!loading">
        <button
          class="filter-tab"
          [class.active]="selectedType === 'all'"
          (click)="onFilterChange('all')"
        >
          Tous ({{ services.length }})
        </button>
        <button
          class="filter-tab"
          [class.active]="selectedType === 'small'"
          (click)="onFilterChange('small')"
        >
          üöó Petit v√©hicule
        </button>
        <button
          class="filter-tab"
          [class.active]="selectedType === 'big'"
          (click)="onFilterChange('big')"
        >
          üöô Grand v√©hicule
        </button>
        <button
          class="filter-tab"
          [class.active]="selectedType === 'salon'"
          (click)="onFilterChange('salon')"
        >
          ‚ú® Salon
        </button>
        <button
          class="filter-tab"
          [class.active]="selectedType === 'pickup'"
          (click)="onFilterChange('pickup')"
        >
          üöö Pick-up
        </button>
      </div>

      <!-- Loading State -->
      <app-loading-spinner
        *ngIf="loading"
        [size]="'medium'"
        [message]="'Chargement des services...'"
        [color]="'primary'"
      >
      </app-loading-spinner>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!loading && services.length === 0">
        <div class="empty-icon">‚öôÔ∏è</div>
        <p>Aucun service trouv√©</p>
      </div>

      <!-- Services Grid - Grouped by Type -->
      <div class="services-grid" *ngIf="!loading && filteredServices.length > 0">
        <div class="service-group-card" *ngFor="let group of getGroupedServicesArray()">
          <!-- Service Type Header -->
          <div class="service-type-header">
            <h2>{{ getServiceTypeLabel(group.type) }}</h2>
            <span class="service-count">{{ group.services.length }} variation(s)</span>
          </div>

          <!-- Service Variations -->
          <div class="service-variations">
            <div class="service-variation" *ngFor="let service of group.services">
              <!-- Service Info -->
              <div class="service-info">
                <div class="service-meta">
                  <div class="meta-item">
                    <span class="meta-icon">üí∞</span>
                    <span class="meta-value">{{ service.price }} TND</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-icon">‚è±Ô∏è</span>
                    <span class="meta-value">{{ formatDuration(service.duration) }}</span>
                  </div>
                  <div class="meta-item" *ngIf="service.type !== 'salon'">
                    <span class="meta-icon">üìç</span>
                    <span class="meta-value">{{ getActiveServiceLocations(service).length }} location(s)</span>
                  </div>
                </div>

                <!-- At-home service message for salon type -->
                <div class="at-home-message" *ngIf="service.type === 'salon'">
                  <span class="home-icon">üè†</span>
                  <span>Service √† domicile</span>
                </div>

                <!-- Locations list for other types -->
                <div class="service-locations" *ngIf="service.type !== 'salon'">
                  <div class="location-item" *ngFor="let location of getActiveServiceLocations(service)">
                    <span class="location-icon">üìç</span>
                    <div class="location-details">
                      <span class="location-address">{{ location.address }}</span>
                      <small class="location-coordinates">
                        {{ location.coordinates[1] }}, {{ location.coordinates[0] }}
                      </small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Service Actions -->
              <div class="service-actions">
                <button class="action-btn edit-btn" (click)="onEditService(service)">
                  ‚úèÔ∏è Modifier
                </button>
                <button class="action-btn delete-btn" (click)="onDeleteService(service)">
                  üóëÔ∏è Supprimer
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filtered Empty State -->
      <div class="empty-state" *ngIf="!loading && services.length > 0 && filteredServices.length === 0">
        <div class="empty-icon">üîç</div>
        <p>Aucun service trouv√© pour ce type</p>
      </div>
    </div>

    <!-- Locations View -->
    <div *ngIf="viewMode === 'locations'">
      <div class="locations-header">
        <button class="add-location-btn" (click)="onAddLocation()">
          ‚ûï Ajouter une localisation
        </button>
      </div>

      <!-- Loading State -->
      <app-loading-spinner
        *ngIf="locationsLoading"
        [size]="'medium'"
        [message]="'Chargement des localisations...'"
        [color]="'primary'"
      >
      </app-loading-spinner>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!locationsLoading && locations.length === 0">
        <div class="empty-icon">üìç</div>
        <p>Aucune localisation trouv√©e</p>
        <button class="add-first-btn" (click)="onAddLocation()">
          Ajouter la premi√®re localisation
        </button>
      </div>

      <!-- Locations Grid -->
      <div class="locations-grid" *ngIf="!locationsLoading && locations.length > 0">
        <div class="location-card" *ngFor="let location of locations">
          <div class="location-status" [class.inactive]="!location.isActive">
            {{ location.isActive ? '‚úÖ Active' : '‚õî Inactive' }}
          </div>

          <div class="location-info">
            <div class="location-main">
              <span class="location-icon-large">üìç</span>
              <div class="location-text">
                <h3 class="location-address">{{ location.address }}</h3>
                <small class="location-coordinates">
                  Lat: {{ location.coordinates[1] | number: '1.4-4' }},
                  Lng: {{ location.coordinates[0] | number: '1.4-4' }}
                </small>
              </div>
            </div>

            <div class="location-usage">
              <span class="usage-icon">üîó</span>
              <span class="usage-text">
                Utilis√©e par {{ getServicesUsingLocation(location) }} service(s)
              </span>
            </div>
          </div>

          <div class="location-actions">
            <button class="action-btn edit-btn" (click)="onEditLocation(location)">
              ‚úèÔ∏è Modifier
            </button>
            <button class="action-btn delete-btn" (click)="onDeleteLocation(location)">
              üóëÔ∏è Supprimer
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="closeDeleteConfirm()">
  <div class="modal-content delete-confirm" (click)="$event.stopPropagation()">
    <h3>Confirmer la suppression</h3>
    <p *ngIf="serviceToDelete">
      √ätes-vous s√ªr de vouloir supprimer le service
      <strong>{{ getServiceTypeLabel(serviceToDelete.type) }}</strong> ?
    </p>
    <p *ngIf="locationToDelete">
      √ätes-vous s√ªr de vouloir supprimer la localisation
      <strong>{{ locationToDelete.address }}</strong> ?
    </p>
    <p class="warning-text">Cette action est irr√©versible.</p>
    <div class="modal-actions">
      <button class="btn-secondary" (click)="closeDeleteConfirm()" [disabled]="deleteLoading">
        Annuler
      </button>
      <button class="btn-danger" (click)="confirmDelete()" [disabled]="deleteLoading">
        {{ deleteLoading ? 'Suppression...' : 'Supprimer' }}
      </button>
    </div>
  </div>
</div>
