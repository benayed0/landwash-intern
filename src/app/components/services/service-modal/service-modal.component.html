<div class="modal-container">
  <div class="modal-header">
    <h2 mat-dialog-title>Modifier le Service</h2>
    <button class="close-btn" (click)="onClose()" type="button">&times;</button>
  </div>

  <form (ngSubmit)="onSubmit()" class="modal-form" mat-dialog-content>
    <!-- Service Type (Non-editable) -->
    <div class="form-group">
      <label for="type">Type de service</label>
      <input
        type="text"
        id="type"
        name="type"
        [value]="getDisplayTypeLabel()"
        readonly
        class="readonly-field"
      />
      <small class="field-hint">
        Le type de service ne peut pas être modifié
      </small>
    </div>

    <!-- Car Type (Non-editable) -->
    <div class="form-group">
      <label for="carType">Type de voiture</label>
      <input
        type="text"
        id="carType"
        name="carType"
        [value]="getDisplayCarTypeLabel()"
        readonly
        class="readonly-field"
      />
      <small class="field-hint">
        Le type de voiture ne peut pas être modifié
      </small>
    </div>

    <!-- Price -->
    <div class="form-group">
      <label for="price">Prix (TND) *</label>
      <input
        type="number"
        id="price"
        name="price"
        [(ngModel)]="formData.price"
        [class.error]="errors['price']"
        min="0"
        step="0.01"
        required
      />
      <span class="error-message" *ngIf="errors['price']">{{
        errors['price']
      }}</span>
    </div>

    <!-- Duration -->
    <div class="form-group">
      <label for="duration">Durée (minutes) *</label>
      <input
        type="number"
        id="duration"
        name="duration"
        [(ngModel)]="formData.duration"
        [class.error]="errors['duration']"
        min="1"
        step="5"
        required
      />
      <span class="error-message" *ngIf="errors['duration']">{{
        errors['duration']
      }}</span>
      <small class="field-hint">
        Durée estimée du service en minutes (ex: 60, 90, 120)
      </small>
    </div>

    <!-- Salon Type Message -->
    <div class="form-group" *ngIf="formData.type === 'salon'">
      <div class="info-message">
        <span class="info-icon">ℹ️</span>
        <span>Les services de type "Salon" sont toujours effectués au domicile du client. Aucune localisation n'est requise.</span>
      </div>
    </div>

    <!-- Available Locations Selection -->
    <div class="form-group" *ngIf="formData.type !== 'salon'">
      <label>Localisations disponibles *</label>
      <span class="error-message" *ngIf="errors['locations']">{{
        errors['locations']
      }}</span>

      <div class="info-message" *ngIf="getAvailableLocations().length === 0">
        <span class="info-icon">⚠️</span>
        <span>Aucune localisation active disponible. Veuillez d'abord créer des localisations dans l'onglet "Localisations".</span>
      </div>

      <div class="locations-selection" *ngIf="getAvailableLocations().length > 0">
        <div
          class="location-checkbox"
          *ngFor="let location of getAvailableLocations()"
        >
          <label class="checkbox-label">
            <input
              type="checkbox"
              [checked]="isLocationSelected(location._id!)"
              (change)="toggleLocation(location._id!)"
            />
            <div class="location-info-check">
              <span class="location-address">{{ location.address }}</span>
              <small class="location-coordinates">
                Lat: {{ location.coordinates[1] | number: '1.4-4' }},
                Lng: {{ location.coordinates[0] | number: '1.4-4' }}
              </small>
            </div>
          </label>
        </div>
      </div>

      <small class="field-hint">
        Sélectionnez au moins une localisation où ce service est disponible.
        Les localisations peuvent être gérées dans l'onglet "Localisations".
      </small>
    </div>

    <!-- Form Actions -->
    <div class="form-actions" mat-dialog-actions>
      <button
        type="button"
        class="btn-secondary"
        (click)="onClose()"
        [disabled]="isSubmitting"
      >
        Annuler
      </button>
      <button type="submit" class="btn-primary" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Enregistrement...' : 'Modifier' }}
      </button>
    </div>
  </form>
</div>
