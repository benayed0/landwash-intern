<div class="modal-container">
  <div class="modal-header">
    <h2 mat-dialog-title>Modifier le Service</h2>
    <button class="close-btn" (click)="onClose()" type="button">&times;</button>
  </div>

  <form (ngSubmit)="onSubmit()" class="modal-form" mat-dialog-content>
    <!-- Service Type -->
    <div class="form-group">
      <label for="type">Type de service *</label>
      <select
        id="type"
        name="type"
        [(ngModel)]="formData.type"
        [class.error]="errors['type']"
        required
      >
        <option value="">S√©lectionner un type</option>
        <option *ngFor="let type of bookingTypes" [value]="type">
          {{ getTypeLabel(type) }}
        </option>
      </select>
      <span class="error-message" *ngIf="errors['type']">{{
        errors['type']
      }}</span>
    </div>

    <!-- Price -->
    <div class="form-group">
      <label for="price">Prix (TND) *</label>
      <input
        type="number"
        id="price"
        name="price"
        [(ngModel)]="formData.price"
        [class.error]="errors['price']"
        min="0"
        step="0.01"
        required
      />
      <span class="error-message" *ngIf="errors['price']">{{
        errors['price']
      }}</span>
    </div>

    <!-- Duration -->
    <div class="form-group">
      <label for="duration">Dur√©e (minutes) *</label>
      <input
        type="number"
        id="duration"
        name="duration"
        [(ngModel)]="formData.duration"
        [class.error]="errors['duration']"
        min="1"
        step="5"
        required
      />
      <span class="error-message" *ngIf="errors['duration']">{{
        errors['duration']
      }}</span>
      <small class="field-hint">
        Dur√©e estim√©e du service en minutes (ex: 60, 90, 120)
      </small>
    </div>

    <!-- Salon Type Message -->
    <div class="form-group" *ngIf="formData.type === 'salon'">
      <div class="info-message">
        <span class="info-icon">‚ÑπÔ∏è</span>
        <span>Les services de type "Salon" sont toujours effectu√©s au domicile du client. Aucune localisation n'est requise.</span>
      </div>
    </div>

    <!-- Available Locations -->
    <div class="form-group" *ngIf="formData.type !== 'salon'">
      <div class="locations-header">
        <label>Localisations disponibles *</label>
        <button type="button" class="add-location-btn" (click)="addLocation()">
          + Ajouter une localisation
        </button>
      </div>
      <span class="error-message" *ngIf="errors['locations']">{{
        errors['locations']
      }}</span>

      <div class="locations-list">
        <div
          class="location-item"
          *ngFor="let location of formData.availableLocations; let i = index"
        >
          <div class="location-header">
            <h4>Localisation {{ i + 1 }}</h4>
            <div class="location-actions">
              <button
                type="button"
                class="edit-location-btn"
                (click)="editLocation(i)"
                *ngIf="editingLocationIndex() !== i"
              >
                ‚úèÔ∏è Modifier
              </button>
              <button
                type="button"
                class="remove-location-btn"
                (click)="removeLocation(i)"
                *ngIf="formData.availableLocations.length > 1"
              >
                üóëÔ∏è Supprimer
              </button>
            </div>
          </div>

          <!-- Location Display (when not editing) -->
          <div class="location-display" *ngIf="editingLocationIndex() !== i">
            <div class="location-info">
              <span class="location-icon">üìç</span>
              <div class="location-details">
                <div class="location-address">{{ location.address || 'Adresse non d√©finie' }}</div>
                <div class="location-coordinates">
                  Lat: {{ location.coordinates[1] | number: '1.4-4' }},
                  Lng: {{ location.coordinates[0] | number: '1.4-4' }}
                </div>
              </div>
            </div>
          </div>

          <!-- Location Picker (when editing) -->
          <div class="location-picker-wrapper" *ngIf="editingLocationIndex() === i">
            <app-location-picker
              [initialLocation]="getInitialLocation(i)"
              placeholder="Rechercher une adresse en Tunisie..."
              (locationSelected)="onLocationSelected($event, i)"
            ></app-location-picker>
            <span class="error-message" *ngIf="errors['address_' + i] || errors['coordinates_' + i]">
              {{ errors['address_' + i] || errors['coordinates_' + i] }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions" mat-dialog-actions>
      <button
        type="button"
        class="btn-secondary"
        (click)="onClose()"
        [disabled]="isSubmitting"
      >
        Annuler
      </button>
      <button type="submit" class="btn-primary" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Enregistrement...' : 'Modifier' }}
      </button>
    </div>
  </form>
</div>
