<div class="booking-card">
 @if (!isEditing) {
  <!-- Normal View -->
  <div class="booking-header">
    <div class="vehicle-type">
      <div class="vehicle-icon">{{ getVehicleIcon(booking.type) }}</div>
      <span>
        {{ getVehicleTypeLabel(booking.type) }}
        @if (booking.type === 'salon' && booking.salonsSeats) {
        <span class="salon-seats"> ({{ booking.salonsSeats }} siÃ¨ges) </span>
        }
      </span>
    </div>
    <span class="status-badge" [ngClass]="'status-' + booking.status">
      {{
        booking.status === "pending"
          ? "En attente"
          : booking.status === "confirmed"
          ? "ConfirmÃ©"
          : booking.status === "completed"
          ? "TerminÃ©"
          : booking.status === "rejected"
          ? "RejetÃ©"
          : booking.status === "canceled"
          ? "AnnulÃ©"
          : booking.status
      }}
    </span>
  </div>
  } @else {
  <!-- Edit Mode -->
  <div class="edit-header">
    <h3>Modifier la rÃ©servation</h3>
    <div class="edit-actions">
      <button class="save-btn" (click)="saveEdit()" [disabled]="!isValidEdit()">
        ğŸ’¾ Sauvegarder
      </button>
      <button class="cancel-btn" (click)="cancelEdit()">âœ–ï¸ Annuler</button>
    </div>
  </div>

  <div class="edit-form">
    <div class="form-group">
      <label>Type de vÃ©hicule</label>
      <select [(ngModel)]="editForm.type" class="form-input">
        <option value="small">Citadines / Petites Voitures</option>
        <option value="big">SUV / Grandes Voitures</option>
        <option value="salon">Salon</option>
      </select>
    </div>

    @if (editForm.type === 'salon') {
    <div class="form-group">
      <label>Nombre de siÃ¨ges</label>
      <input
        type="number"
        [(ngModel)]="editForm.salonsSeats"
        min="1"
        max="20"
        class="form-input"
      />
    </div>
    }

    <div class="form-group">
      <label>Prix (DT)</label>
      <input
        type="number"
        [(ngModel)]="editForm.price"
        min="0"
        step="0.1"
        class="form-input"
      />
    </div>

    <div class="form-group">
      <label>Date</label>
      <input type="date" [(ngModel)]="editForm.date" class="form-input" />
    </div>

    <div class="form-group">
      <label>Statut</label>
      <select [(ngModel)]="editForm.status" class="form-input">
        <option value="pending">En attente</option>
        <option value="confirmed">ConfirmÃ©</option>
        <option value="completed">TerminÃ©</option>
        <option value="rejected">RejetÃ©</option>
        <option value="canceled">AnnulÃ©</option>
      </select>
    </div>

    <div class="form-group">
      <label>Adresse</label>
      <textarea
        [(ngModel)]="editForm.address"
        class="form-input textarea"
        rows="2"
      ></textarea>
    </div>

    <div class="form-group">
      <label>NumÃ©ro secondaire</label>
      <input
        type="tel"
        [(ngModel)]="editForm.secondaryNumber"
        class="form-input"
      />
    </div>

    <div class="form-group checkbox-group">
      <label class="checkbox-label">
        <input
          type="checkbox"
          [(ngModel)]="editForm.withSub"
          class="checkbox"
        />
        <span class="checkmark"></span>
        Avec abonnement
      </label>
    </div>
  </div>
  } @if (!isEditing) {
  <div class="booking-date">ğŸ“… {{ formatDate(booking.date) }}</div>

  <div class="booking-address">
    <span>ğŸ“</span>
    <span>
      <a
        href="https://www.google.com/maps/search/?api=1&query={{
          booking.location.lat
        }},{{ booking.location.lng }}"
        target="_blank"
        rel="noopener noreferrer"
      >
        {{ booking.address || "Adresse non spÃ©cifiÃ©e" }}
      </a></span
    >
  </div>

  <!-- Client Information (enhanced for workers) -->
  @if (booking.userId) {
  <div class="user-info" [class.worker-view]="userRole === 'worker'">
    @if (booking.userId.name) {
    <div class="client-name">Client: {{ booking.userId.name }}</div>
    } @if (booking.userId.phoneNumber) {
    <div class="client-phone">
      ğŸ“±
      <a href="tel:{{ booking.userId.phoneNumber }}" class="client-phone">{{
        booking.userId.phoneNumber
      }}</a>
    </div>
    } @if (booking.secondaryNumber) {
    <div class="client-phone">
      ğŸ“± Secondaire:
      <a href="tel:{{ booking.secondaryNumber }}" class="client-phone">{{
        booking.secondaryNumber
      }}</a>
    </div>
    }
  </div>
  }

  <div class="price-section">
    <div class="booking-price">{{ booking.price }} DT</div>
    @if (canEdit()) {
    <button class="edit-btn" (click)="startEdit()" title="Modifier la rÃ©servation">
      âœï¸ Modifier
    </button>
    }
  </div>
  @if (booking.teamId ) {
  <div class="team-info">
    <div class="team-details">
      <span class="team-icon">ğŸ‘¥</span>
      <span class="team-label">Ã‰quipe assignÃ©e:</span>
      <span class="team-name">{{ getTeamName(booking.teamId) }}</span>
      @if (booking.teamId && getChiefName(booking.teamId)) {
      <span class="team-chief">
        (Chef: {{ getChiefName(booking.teamId) }})
      </span>
      }
    </div>
    @if (userRole === 'admin') {
    <button
      class="change-team-btn"
      (click)="triggerRequestReassignTeam()"
      title="Changer l'Ã©quipe"
    >
      ğŸ”„ Changer
    </button>
    }
  </div>
  } @if (booking.status === 'pending') {
  <div class="booking-actions">
    <button class="action-btn confirm-btn" (click)="confirmBooking()">
      âœ“ Confirmer
    </button>
    <button class="action-btn reject-btn" (click)="rejectBooking()">
      âœ— Rejeter
    </button>
  </div>
  } @if (booking.status === 'confirmed') {
  <div class="booking-actions">
    <button class="action-btn complete-btn" (click)="completeBooking()">
      âœ“ Marquer comme terminÃ©
    </button>
    <button class="action-btn reject-btn" (click)="rejectBooking()">
      âœ— Rejeter
    </button>
  </div>
  } @if (booking.status === 'rejected') {
  <div class="booking-actions">
    <button class="action-btn confirm-btn" (click)="reconfirmBooking()">
      ğŸ”„ Reconfirmer
    </button>
  </div>
  } }
</div>
