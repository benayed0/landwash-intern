<div class="booking-list-container">
  <div class="page-header">
    <button class="add-user-btn" (click)="openAddBookingModal()">
      ‚ûï Ajouter une r√©servation
    </button>
  </div>
  <!-- Sub-tabs for Bookings -->
  <div class="tabs">
    <button
      class="tab"
      [class.active]="activeTab === 'pending'"
      (click)="activeTab = 'pending'"
    >
      En attente ({{ filteredPendingBookings().length }})
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'confirmed'"
      (click)="activeTab = 'confirmed'"
    >
      Confirm√©es ({{ filteredConfirmedBookings().length }})
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'in-progress'"
      (click)="activeTab = 'in-progress'"
    >
      En cours ({{ filteredInProgressBookings().length }})
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'completed'"
      (click)="activeTab = 'completed'"
    >
      Historique ({{ filteredCompletedBookings().length }})
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'others'"
      (click)="activeTab = 'others'"
    >
      Autres ({{
        filteredRejectedBookings().length + filteredCanceledBookings().length
      }})
    </button>
  </div>
  <!-- Filters Section -->
  <div class="filters-section">
    <!-- Date Filter -->
    <div class="filter-group">
      <h3>Filtrer par date</h3>
      <div class="preset-buttons">
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === 'all'"
          (click)="setDatePreset('all')"
        >
          Tout
        </button>
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === 'today'"
          (click)="setDatePreset('today')"
        >
          Aujourd'hui
        </button>
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === '7days'"
          (click)="setDatePreset('7days')"
        >
          7 jours
        </button>
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === '30days'"
          (click)="setDatePreset('30days')"
        >
          30 jours
        </button>
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === 'custom'"
          (click)="setDatePreset('custom')"
        >
          Personnalis√©
        </button>
      </div>

      <div class="custom-date-inputs" *ngIf="selectedPreset() === 'custom'">
        <div class="date-input-group">
          <label>Date de d√©but</label>
          <input
            type="date"
            [value]="startDate()"
            (input)="onStartDateChange($event)"
            class="date-input"
          />
        </div>
        <div class="date-input-group">
          <label>Date de fin</label>
          <input
            type="date"
            [value]="endDate()"
            (input)="onEndDateChange($event)"
            class="date-input"
          />
        </div>
        <button
          class="apply-btn"
          (click)="applyDateFilter()"
          [disabled]="!isDateRangeValid()"
        >
          Appliquer
        </button>
      </div>
    </div>

    <!-- Team/Personnel/Client Filters -->
    <div class="advanced-filters">
      <h3>Filtres avanc√©s</h3>
      <div class="filter-dropdowns">
        <!-- Team Filter -->
        <div class="dropdown-filter">
          <label>√âquipe</label>
          <div class="searchable-select">
            <select [(ngModel)]="selectedTeam" class="filter-select">
              <option value="all">Toutes les √©quipes</option>
              <option *ngFor="let team of filteredTeams()" [value]="team._id">
                {{ team.name }}
              </option>
            </select>
            <input
              type="text"
              placeholder="Rechercher une √©quipe..."
              [(ngModel)]="teamSearchTerm"
              class="search-input"
              (focus)="onSearchFocus($event)"
              (blur)="onSearchBlur($event)"
            />
          </div>
        </div>

        <!-- Personnel Filter -->
        <div class="dropdown-filter">
          <label>Personnel</label>
          <div class="searchable-select">
            <select [(ngModel)]="selectedPersonnel" class="filter-select">
              <option value="all">Tout le personnel</option>
              <option
                *ngFor="let person of filteredPersonnel()"
                [value]="person._id"
              >
                {{ person.name }} ({{ person.email }})
              </option>
            </select>
            <input
              type="text"
              placeholder="Rechercher du personnel..."
              [(ngModel)]="personnelSearchTerm"
              class="search-input"
              (focus)="onSearchFocus($event)"
              (blur)="onSearchBlur($event)"
            />
          </div>
        </div>

        <!-- Client Filter -->
        <div class="dropdown-filter">
          <label>Client</label>
          <div class="searchable-select">
            <select [(ngModel)]="selectedClient" class="filter-select">
              <option value="all">Tous les clients</option>
              <option
                *ngFor="let client of filteredClients()"
                [value]="client._id"
              >
                {{ client.name }} ({{ client.email }})
              </option>
            </select>
            <input
              type="text"
              placeholder="Rechercher un client..."
              [(ngModel)]="clientSearchTerm"
              class="search-input"
              (focus)="onSearchFocus($event)"
              (blur)="onSearchBlur($event)"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="content">
    <h2 class="section-title">{{ sectionTitle }}</h2>

    <app-loading-spinner
      *ngIf="loading"
      [size]="'medium'"
      [message]="'Chargement des r√©servations...'"
      [color]="'primary'"
    >
    </app-loading-spinner>

    <div *ngIf="!loading && currentBookings.length === 0" class="empty-state">
      <div class="empty-icon">üìã</div>
      <p>Aucune r√©servation dans cette cat√©gorie</p>
    </div>

    <div *ngIf="!loading && currentBookings.length > 0">
      <app-booking-card
        *ngFor="let booking of currentBookings"
        [booking]="booking"
        [userRole]="'admin'"
        [showMapsButton]="false"
        (statusChange)="onStatusChange($event)"
        (requestComplete)="onRequestComplete($event)"
        (requestConfirm)="onRequestConfirm($event)"
        (requestReject)="onRequestReject($event)"
        (requestReconfirm)="onRequestReconfirm($event)"
        (requestReassignTeam)="onRequestReassignTeam($event)"
        (requestStartProgress)="onRequestStartProgress($event)"
        (bookingUpdate)="onBookingUpdate($event)"
      >
      </app-booking-card>
    </div>
  </div>
</div>

<!-- Modals -->
<app-price-confirm-modal
  [booking]="selectedBookingForCompletion"
  [isOpen]="showPriceModal"
  (confirmComplete)="onConfirmComplete($event)"
  (close)="closeModal()"
>
</app-price-confirm-modal>

<app-team-assign-modal
  [booking]="selectedBookingForTeam"
  [isOpen]="showTeamModal"
  (confirmAssign)="onConfirmAssign($event)"
  (reassignTeam)="onReassignTeam($event)"
  (close)="closeTeamModal()"
>
</app-team-assign-modal>

<app-reject-confirm-modal
  [booking]="selectedBookingForRejection"
  [isOpen]="showRejectModal"
  (confirmReject)="onConfirmReject()"
  (close)="closeRejectModal()"
>
</app-reject-confirm-modal>

<app-create-booking
  [isOpen]="showCreateBookingModal"
  (bookingCreated)="onBookingCreated()"
  (close)="closeCreateBookingModal()"
>
</app-create-booking>
