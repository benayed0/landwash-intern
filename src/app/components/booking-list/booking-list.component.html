<div class="booking-list-container">
  <!-- Date Range Picker -->
  <div class="date-filter-container">
    <div class="date-filter-header">
      <h3>Filtrer par date</h3>
      <div class="preset-buttons">
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === 'all'"
          (click)="setDatePreset('all')"
        >
          Tout
        </button>
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === 'today'"
          (click)="setDatePreset('today')"
        >
          Aujourd'hui
        </button>
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === '7days'"
          (click)="setDatePreset('7days')"
        >
          7 jours
        </button>
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === '30days'"
          (click)="setDatePreset('30days')"
        >
          30 jours
        </button>
        <button
          class="preset-btn"
          [class.active]="selectedPreset() === 'custom'"
          (click)="setDatePreset('custom')"
        >
          Personnalis√©
        </button>
      </div>
    </div>

    <div class="date-inputs" *ngIf="selectedPreset() === 'custom'">
      <div class="date-input-group">
        <label>Date de d√©but</label>
        <input
          type="date"
          [value]="startDate()"
          (input)="onStartDateChange($event)"
          class="date-input"
        />
      </div>
      <div class="date-input-group">
        <label>Date de fin</label>
        <input
          type="date"
          [value]="endDate()"
          (input)="onEndDateChange($event)"
          class="date-input"
        />
      </div>
      <button
        class="apply-btn"
        (click)="applyDateFilter()"
        [disabled]="!isDateRangeValid()"
      >
        Appliquer
      </button>
    </div>

    <div
      class="current-range"
      *ngIf="selectedPreset() !== 'custom' && selectedPreset() !== 'all'"
    >
      <span class="range-text">
        Du {{ formatDisplayDate(startDate()) }} au
        {{ formatDisplayDate(endDate()) }}
      </span>
    </div>
  </div>

  <!-- Sub-tabs for Bookings -->
  <div class="tabs">
    <button
      class="tab"
      [class.active]="activeTab === 'pending'"
      (click)="activeTab = 'pending'"
    >
      En attente ({{ filteredPendingBookings().length }})
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'confirmed'"
      (click)="activeTab = 'confirmed'"
    >
      Confirm√©es ({{ filteredConfirmedBookings().length }})
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'completed'"
      (click)="activeTab = 'completed'"
    >
      Historique ({{ filteredCompletedBookings().length }})
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'others'"
      (click)="activeTab = 'others'"
    >
      Autres ({{
        filteredRejectedBookings().length + filteredCanceledBookings().length
      }})
    </button>
  </div>

  <div class="content">
    <h2 class="section-title">{{ sectionTitle }}</h2>

    <app-loading-spinner
      *ngIf="loading"
      [size]="'medium'"
      [message]="'Chargement des r√©servations...'"
      [color]="'primary'"
    >
    </app-loading-spinner>

    <div *ngIf="!loading && currentBookings.length === 0" class="empty-state">
      <div class="empty-icon">üìã</div>
      <p>Aucune r√©servation dans cette cat√©gorie</p>
    </div>

    <div *ngIf="!loading && currentBookings.length > 0">
      <app-booking-card
        *ngFor="let booking of currentBookings"
        [booking]="booking"
        [userRole]="'admin'"
        [showMapsButton]="false"
        (statusChange)="onStatusChange($event)"
        (requestComplete)="onRequestComplete($event)"
        (requestConfirm)="onRequestConfirm($event)"
        (requestReject)="onRequestReject($event)"
        (requestReconfirm)="onRequestReconfirm($event)"
        (requestReassignTeam)="onRequestReassignTeam($event)"
        (bookingUpdate)="onBookingUpdate($event)"
      >
      </app-booking-card>
    </div>
  </div>

  <!-- Modals -->
  <app-price-confirm-modal
    [booking]="selectedBookingForCompletion"
    [isOpen]="showPriceModal"
    (confirmComplete)="onConfirmComplete($event)"
    (close)="closeModal()"
  >
  </app-price-confirm-modal>

  <app-team-assign-modal
    [booking]="selectedBookingForTeam"
    [isOpen]="showTeamModal"
    (confirmAssign)="onConfirmAssign($event)"
    (reassignTeam)="onReassignTeam($event)"
    (close)="closeTeamModal()"
  >
  </app-team-assign-modal>

  <app-reject-confirm-modal
    [booking]="selectedBookingForRejection"
    [isOpen]="showRejectModal"
    (confirmReject)="onConfirmReject()"
    (close)="closeRejectModal()"
  >
  </app-reject-confirm-modal>
</div>
