<div class="teams-container">
  <div class="content">
    <app-loading-spinner
      *ngIf="loading"
      [size]="'medium'"
      [message]="'Chargement des √©quipes...'"
      [color]="'primary'"
    >
    </app-loading-spinner>

    <div *ngIf="!loading">
      <!-- Search Bar -->
      <div class="search-container">
        <div class="search-input-wrapper">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
            placeholder="Rechercher √©quipes ou personnel..."
            class="search-input"
          />
          <button
            *ngIf="searchTerm"
            class="clear-search-btn"
            (click)="clearSearch()"
          >
            ‚úï
          </button>
          <div class="search-icon">üîç</div>
        </div>
        <div class="search-results" *ngIf="searchTerm">
          <span
            >{{ filteredTeams.length }} √©quipe(s) ‚Ä¢
            {{ filteredPersonals.length }} personnel(s)</span
          >
        </div>
      </div>

      <!-- Teams Section -->
      <div class="section-header">
        <div class="section-title">√âquipes</div>
        <button class="add-btn" (click)="showCreateTeamModal = true">
          Cr√©er une √âquipe
        </button>
      </div>

      <div
        *ngIf="filteredTeams.length === 0 && !searchTerm"
        class="empty-state"
      >
        <p>Aucune √©quipe disponible</p>
      </div>

      <div *ngIf="filteredTeams.length === 0 && searchTerm" class="empty-state">
        <p>Aucun r√©sultat trouv√© pour "{{ searchTerm }}"</p>
      </div>

      <div class="teams-grid">
        <div class="team-card" *ngFor="let team of paginatedTeams">
          <div class="team-header">
            <div class="team-name">{{ team.name }}</div>
            <div class="team-header-actions">
              <div class="team-badge">
                {{ team.members.length || 0 }} membres
              </div>
              <div class="team-actions">
                <button
                  class="action-btn edit-btn"
                  (click)="openEditTeam(team)"
                  title="Modifier l'√©quipe"
                >
                  ‚úèÔ∏è
                </button>
                <button
                  class="action-btn delete-btn"
                  (click)="openDeleteConfirm(team)"
                  title="Supprimer l'√©quipe"
                >
                  üóëÔ∏è
                </button>
              </div>
            </div>
          </div>

          <!-- Location and Radius Info -->
          <div class="team-location" *ngIf="team.coordinates">
            <div class="location-item">
              <span class="location-icon">üìç</span>
              <span class="location-text"
                >{{ team.coordinates[1].toFixed(4) }},
                {{ team.coordinates[0].toFixed(4) }}</span
              >
            </div>
            <div class="location-item" *ngIf="team.radius">
              <span class="location-icon">üéØ</span>
              <span class="location-text">Rayon: {{ team.radius }}km</span>
            </div>
          </div>

          <div
            class="member-list"
            *ngIf="team.members && team.members.length > 0"
          >
            <div class="member-item" *ngFor="let memberId of team.members">
              <div
                class="member-avatar"
                *ngIf="getMemberDetails(memberId) as member"
              >
                {{ getInitials(member.name) }}
              </div>
              <div
                class="member-info"
                *ngIf="getMemberDetails(memberId) as member"
              >
                <div class="member-name">{{ member.name }}</div>
                <div class="member-contact">
                  {{ member.phone }} ‚Ä¢ {{ member.email }}
                </div>
              </div>
              <div
                class="member-role"
                *ngIf="getMemberDetails(memberId) as member"
              >
                {{ member.role }}
              </div>
            </div>
          </div>
        </div>

        <!-- Teams Pagination -->
        <div class="pagination" *ngIf="totalTeamPages > 1">
          <button
            class="pagination-btn"
            [disabled]="currentTeamPage === 1"
            (click)="onTeamPageChange(currentTeamPage - 1)"
          >
            ‚Üê
          </button>

          <button
            *ngFor="let page of getTeamPageNumbers()"
            class="pagination-btn"
            [class.active]="page === currentTeamPage"
            (click)="onTeamPageChange(page)"
          >
            {{ page }}
          </button>

          <button
            class="pagination-btn"
            [disabled]="currentTeamPage === totalTeamPages"
            (click)="onTeamPageChange(currentTeamPage + 1)"
          >
            ‚Üí
          </button>
        </div>

        <!-- Personnel Section -->
        <div class="section-header">
          <div class="section-title">Tout le Personnel</div>
          <button class="add-btn" (click)="showAddPersonalModal = true">
            Cr√©er un Compte
          </button>
        </div>

        <div
          *ngIf="filteredPersonals.length === 0 && !searchTerm"
          class="empty-state"
        >
          <p>Aucun personnel disponible</p>
        </div>

        <div
          *ngIf="filteredPersonals.length === 0 && searchTerm"
          class="empty-state"
        >
          <p>Aucun personnel trouv√© pour "{{ searchTerm }}"</p>
        </div>

        <div class="personals-grid">
          <div
            class="personal-card"
            *ngFor="let personal of paginatedPersonals"
          >
            <div class="personal-avatar">
              {{ getInitials(personal.name) }}
            </div>
            <div class="personal-info">
              <div class="personal-name">{{ personal.name }}</div>
              <div class="personal-details">
                {{ personal.email }}<br />
                {{ personal.phone }}
              </div>
            </div>
            <div class="personal-role">
              {{ personal.role === "admin" ? "Administrateur" : "Employ√©" }}
            </div>
          </div>
        </div>

        <!-- Personnel Pagination -->
        <div class="pagination" *ngIf="totalPersonalPages > 1">
          <button
            class="pagination-btn"
            [disabled]="currentPersonalPage === 1"
            (click)="onPersonalPageChange(currentPersonalPage - 1)"
          >
            ‚Üê
          </button>

          <button
            *ngFor="let page of getPersonalPageNumbers()"
            class="pagination-btn"
            [class.active]="page === currentPersonalPage"
            (click)="onPersonalPageChange(page)"
          >
            {{ page }}
          </button>

          <button
            class="pagination-btn"
            [disabled]="currentPersonalPage === totalPersonalPages"
            (click)="onPersonalPageChange(currentPersonalPage + 1)"
          >
            ‚Üí
          </button>
        </div>
      </div>
    </div>
    <app-add-personal-modal
      (close)="showAddPersonalModal = false"
      [isOpen]="showAddPersonalModal"
      (confirmAdd)="createdAccount($event)"
    ></app-add-personal-modal>

    <app-create-team-modal
      (close)="showCreateTeamModal = false"
      [isOpen]="showCreateTeamModal"
      [availablePersonals]="personals"
      (teamCreated)="teamCreated($event)"
    ></app-create-team-modal>

    <app-edit-team-modal
      (close)="showEditTeamModal = false"
      [isOpen]="showEditTeamModal"
      [team]="selectedTeam"
      [availablePersonals]="personals"
      (teamUpdated)="teamUpdated($event)"
    ></app-edit-team-modal>

    <app-delete-confirm-modal
      (close)="closeDeleteConfirm()"
      [isOpen]="showDeleteConfirmModal"
      [teamName]="selectedTeam?.name || ''"
      [isDeleting]="isDeleting"
      (confirm)="confirmDelete()"
    ></app-delete-confirm-modal>
  </div>
</div>
