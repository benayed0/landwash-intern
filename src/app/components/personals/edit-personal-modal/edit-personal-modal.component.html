<h2 mat-dialog-title>
  <mat-icon>edit</mat-icon>
  Modifier le personnel
</h2>

<mat-dialog-content>
  <form (ngSubmit)="onSubmit()" #personalForm="ngForm">
    <!-- Name Field -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nom complet</mat-label>
      <input
        matInput
        [(ngModel)]="editedPersonal.name"
        name="name"
        placeholder="Ex: Jean Dupont"
        required
        [disabled]="isSubmitting"
      />
      <mat-icon matPrefix>person</mat-icon>
      <mat-error *ngIf="nameError">{{ nameError }}</mat-error>
    </mat-form-field>

    <!-- Email Field -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Adresse email</mat-label>
      <input
        matInput
        type="email"
        [(ngModel)]="editedPersonal.email"
        name="email"
        placeholder="Ex: jean.dupont@example.com"
        required
        [disabled]="isSubmitting"
      />
      <mat-icon matPrefix>email</mat-icon>
      <mat-error *ngIf="emailError">{{ emailError }}</mat-error>
    </mat-form-field>

    <!-- Phone Field (Optional) -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Téléphone (optionnel)</mat-label>
      <input
        matInput
        type="tel"
        [(ngModel)]="editedPersonal.phone"
        name="phone"
        placeholder="Ex: +216 XX XXX XXX"
        [disabled]="isSubmitting"
      />
      <mat-icon matPrefix>phone</mat-icon>
      <mat-error *ngIf="phoneError">{{ phoneError }}</mat-error>
    </mat-form-field>

    <!-- Role Field -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Rôle</mat-label>
      <mat-select
        [(ngModel)]="editedPersonal.role"
        name="role"
        required
        [disabled]="isSubmitting"
      >
        <mat-option value="worker">
          <mat-icon>engineering</mat-icon>
          Travailleur
        </mat-option>
        <mat-option value="admin">
          <mat-icon>admin_panel_settings</mat-icon>
          Administrateur
        </mat-option>
      </mat-select>
      <mat-icon matPrefix>badge</mat-icon>
    </mat-form-field>

    <!-- Password Reset Section -->
    <div class="password-section">
      <!-- Password Field with Generator -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nouveau mot de passe</mat-label>
        <input
          matInput
          [type]="passwordVisible ? 'text' : 'password'"
          [(ngModel)]="newPassword"
          name="password"
          readonly
          [disabled]="isSubmitting"
        />
        <mat-icon matPrefix>lock</mat-icon>
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="togglePasswordVisibility()"
          [disabled]="isSubmitting"
          [attr.aria-label]="'Toggle password visibility'"
        >
          <mat-icon>{{
            passwordVisible ? "visibility_off" : "visibility"
          }}</mat-icon>
        </button>
      </mat-form-field>

      <!-- Password Actions -->
      <div class="password-actions">
        <button
          mat-stroked-button
          type="button"
          class="action-btn copy-btn"
          (click)="copyPassword()"
          [disabled]="isSubmitting"
        >
          <mat-icon>content_copy</mat-icon>
          Copier
        </button>
        <button
          mat-stroked-button
          type="button"
          class="action-btn"
          (click)="regeneratePassword()"
          [disabled]="isSubmitting"
        >
          <mat-icon>refresh</mat-icon>
          Régénérer
        </button>
      </div>

      <mat-hint class="password-hint">
        <mat-icon inline>info</mat-icon>
        Copiez ce mot de passe et communiquez-le au personnel de manière
        sécurisée.
      </mat-hint>
    </div>

    <!-- Info Message -->
    <div class="info-message" *ngIf="resetPassword">
      <mat-icon>email</mat-icon>
      <p>
        Un email de notification sera envoyé pour informer du changement de mot
        de passe.
      </p>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button
    mat-stroked-button
    type="button"
    (click)="onCancel()"
    [disabled]="isSubmitting"
  >
    <mat-icon>close</mat-icon>
    Annuler
  </button>
  <button
    mat-raised-button
    color="primary"
    type="button"
    (click)="onSubmit()"
    [disabled]="isSubmitting"
  >
    <mat-icon *ngIf="!isSubmitting">check</mat-icon>
    <mat-icon *ngIf="isSubmitting" class="spinning">hourglass_empty</mat-icon>
    <span *ngIf="!isSubmitting">Mettre à jour</span>
    <span *ngIf="isSubmitting">Mise à jour...</span>
  </button>
</mat-dialog-actions>
